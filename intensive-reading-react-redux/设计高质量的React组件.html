<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>设计高质量的React组件 | 梅格Drum</title>
    <meta name="description" content="Just playing around">
    <link rel="icon" href="/img/logo.ico">
  <link rel="mainfest" href="/manifest.json">
    
    <link rel="preload" href="/assets/css/0.styles.45b3d53f.css" as="style"><link rel="preload" href="/assets/js/app.5e2fb6a2.js" as="script"><link rel="preload" href="/assets/js/2.e64ac863.js" as="script"><link rel="preload" href="/assets/js/3.41b3c96f.js" as="script"><link rel="prefetch" href="/assets/js/10.06160dd2.js"><link rel="prefetch" href="/assets/js/4.9dd03212.js"><link rel="prefetch" href="/assets/js/5.f67afb7f.js"><link rel="prefetch" href="/assets/js/6.84d2832a.js"><link rel="prefetch" href="/assets/js/7.7e1505d7.js"><link rel="prefetch" href="/assets/js/8.c4d88ebe.js"><link rel="prefetch" href="/assets/js/9.b06fc0c6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.45b3d53f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">梅格Drum</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/chinese/" class="nav-link">Chinese</a></li><li class="dropdown-item"><!----> <a href="/language/japanese/" class="nav-link">Japanese</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/chinese/" class="nav-link">Chinese</a></li><li class="dropdown-item"><!----> <a href="/language/japanese/" class="nav-link">Japanese</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/intensive-reading-react-redux/" class="sidebar-link">精读深入浅出React与Redux</a></li><li><a href="/intensive-reading-react-redux/React新的前端思维方式.html" class="sidebar-link">React新的前端思维方式</a></li><li><a href="/intensive-reading-react-redux/设计高质量的React组件.html" class="active sidebar-link">设计高质量的React组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/intensive-reading-react-redux/设计高质量的React组件.html#如何划分组件？" class="sidebar-link">如何划分组件？</a></li><li class="sidebar-sub-header"><a href="/intensive-reading-react-redux/设计高质量的React组件.html#确定-ui-state-的最小（且完整）表示" class="sidebar-link">确定 UI state 的最小（且完整）表示</a></li><li class="sidebar-sub-header"><a href="/intensive-reading-react-redux/设计高质量的React组件.html#确定-state-放置的位置" class="sidebar-link">确定 state 放置的位置</a></li><li class="sidebar-sub-header"><a href="/intensive-reading-react-redux/设计高质量的React组件.html#对象形式的数据如何渲染？" class="sidebar-link">对象形式的数据如何渲染？</a></li><li class="sidebar-sub-header"><a href="/intensive-reading-react-redux/设计高质量的React组件.html#react中如何更好的修改数组中对象的数据？" class="sidebar-link">React中如何更好的修改数组中对象的数据？</a></li><li class="sidebar-sub-header"><a href="/intensive-reading-react-redux/设计高质量的React组件.html#计算一个数组中某些值的总和？reduce" class="sidebar-link">计算一个数组中某些值的总和？reduce</a></li><li class="sidebar-sub-header"><a href="/intensive-reading-react-redux/设计高质量的React组件.html#生命周期" class="sidebar-link">生命周期</a></li></ul></li><li><a href="/intensive-reading-react-redux/React组件的性能优化.html" class="sidebar-link">React组件的性能优化</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="设计高质量的react组件"><a href="#设计高质量的react组件" aria-hidden="true" class="header-anchor">#</a> 设计高质量的React组件</h1> <ol><li>React组件、state、props如何划分？</li> <li>对象形式的数据如何渲染？</li> <li>如何根据单一职责划分组件？</li> <li>如何更好的修改数组中对象的数据？利用filter、map重新构造新数组</li> <li>计算一个数组中某些值的总和？reduce</li></ol> <h2 id="如何划分组件？"><a href="#如何划分组件？" aria-hidden="true" class="header-anchor">#</a> 如何划分组件？</h2> <p>就像一个人最好一次只专注做一件事一样，也尽量保持一个组件做一件事情。开发者发现一个组件的功能太多代码量太大的时候，就需要考虑拆分这个组件，用多个组件来代替。</p> <p>拆分组件最关键是确定组件边界，每个组件都应该是可以独立存在的，如果两个组件逻辑太紧密，无法清晰定义各自的责任，也许这两个组件本身就不应该被拆开，作为同一个组件也许更合理。</p> <p><strong>先通过 UI 不同部分来划分组件，然后再用“根据数据边界划分组件”这个原则来确认组件划分是否合理。</strong></p> <img src="/assets/img/clock.c5740c2e.png" style="zoom:60%;"> <table><thead><tr><th style="text-align:center;">数据</th> <th style="text-align:center;">标识符</th> <th style="text-align:center;">影响的组件</th></tr></thead> <tbody><tr><td style="text-align:center;">当前时间</td> <td style="text-align:center;">timeElapsed</td> <td style="text-align:center;">MajorClock</td></tr> <tr><td style="text-align:center;">启动状态</td> <td style="text-align:center;">activated</td> <td style="text-align:center;">MajorClock,ControlButton</td></tr> <tr><td style="text-align:center;">计次时间</td> <td style="text-align:center;">splits</td> <td style="text-align:center;">SplitTime</td></tr></tbody></table> <ol><li><code>timeElapsed</code>是一个时间差，影响时间展示组件。</li> <li><code>activated</code>是启动状态，影响按钮组件状态和是否由暂停变为启动。</li> <li><code>splits</code>是一个计次数组，影响数据展示组件。</li></ol> <p>但是这些数据都是需要别的地方所控制，所以都提升到父组件去维护。</p> <p><strong>我们在看一个</strong></p> <img src="/assets/img/todo-list.87ed7389.png" style="zoom:60%;"> <h2 id="确定-ui-state-的最小（且完整）表示"><a href="#确定-ui-state-的最小（且完整）表示" aria-hidden="true" class="header-anchor">#</a> 确定 UI state 的最小（且完整）表示</h2> <p>通过问自己以下三个问题，你可以逐个检查相应数据是否属于 state：</p> <ol><li>该数据是否是由父组件通过 props 传递而来的？如果是，那它应该不是 state。</li> <li>该数据是否随时间的推移而保持不变？如果是，那它应该也不是 state。</li> <li><strong>你能否根据其他 state 或 props 计算出该数据的值</strong>？如果是，那它也不是 state。</li></ol> <p>首先<strong>输入框</strong>的值可以不断变化，所以他是<code>state</code>,<strong>列表</strong>展示完全可以由<code>props</code>传递过来，所以列表组件是<code>props</code>,至于<strong>复选框</strong>的值会不断发生变化，因为他是由存在JSON对象中，所以更改的时候只需改变JSON的值，就不需要单独的<code>state</code>去维护了，底部功能组件的items数量完全可以由列表数据计算，所以不需要state,可以在render时动态计算，而三个切换展示按钮不断选择更改，所以他不是props,他是state,至于清除已完成按钮的展示属性可以通过计算的方式获得，也不是state,而是render计算传递props。</p> <table><thead><tr><th>数据含义</th> <th>state 变量</th> <th>影响的组件</th></tr></thead> <tbody><tr><td>input输入框的值</td> <td>taskText</td> <td>TaskBar</td></tr> <tr><td>底部功能按钮切换的状态</td> <td>isSelected</td> <td>Footer</td></tr> <tr><td>用来获取列表数据</td> <td>taskList</td> <td>Index公共父组件</td></tr></tbody></table> <h2 id="确定-state-放置的位置"><a href="#确定-state-放置的位置" aria-hidden="true" class="header-anchor">#</a> 确定 state 放置的位置</h2> <p>对于应用中的每一个 state：</p> <ul><li>找到根据这个 state 进行渲染的所有组件。</li> <li>找到他们的共同所有者（common owner）组件（在组件层级上高于所有需要该 state 的组件）。</li> <li>该共同所有者组件或者比它层级更高的组件应该拥有该 state。</li> <li>如果你找不到一个合适的位置来存放该 state，就可以直接创建一个新的组件来存放该 state，并将这一新组件置于高于共同所有者组件层级的位置。</li></ul> <p>上面三个state统统放到Index这个父组件中，因为taskText，如果按下输入框回车之后会把内容添加到taskList中，从而影响TodoItem组件，isSelected是功能展示过滤用，会影响到TodoItem数据，所以放到Index中。</p> <table><thead><tr><th>数据含义</th> <th>props 标识符</th> <th>影响的组件</th> <th>from state /函数/计算</th></tr></thead> <tbody><tr><td>input 值</td> <td>taskText</td> <td>TaskBar</td> <td>taskText</td></tr> <tr><td>input 值 改变</td> <td>handleTaskTextChange</td> <td>TaskBar</td> <td>函数</td></tr> <tr><td>添加进列表</td> <td>handlePressEnter</td> <td>TaskBar、TodoItem</td> <td>函数</td></tr> <tr><td>列表组件展示的数据</td> <td>showList</td> <td>TodoItem</td> <td>taskList + isSelected计算</td></tr> <tr><td>删除某一项</td> <td>handleDeleteItem</td> <td>TodoItem</td> <td>函数</td></tr> <tr><td>改变某一项状态</td> <td>handleToogle</td> <td>TodoItem</td> <td>函数</td></tr> <tr><td>当前功能按钮状态</td> <td>isSelected</td> <td>Footer、TaskBar</td> <td>isSelected</td></tr> <tr><td>未完成数量</td> <td>count</td> <td>Footer</td> <td>taskList计算</td></tr> <tr><td>已完成数量</td> <td>completedCount</td> <td>Footer</td> <td>taskList计算</td></tr></tbody></table> <h2 id="对象形式的数据如何渲染？"><a href="#对象形式的数据如何渲染？" aria-hidden="true" class="header-anchor">#</a> 对象形式的数据如何渲染？</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
	a<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'aAa'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token string">'22'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'aAA'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token string">'22'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	b<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'bbB'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token string">'24'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>item<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
          <span class="token punctuation">{</span>
            obj<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">itm</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token punctuation">(</span>
                <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>itm<span class="token punctuation">.</span>name<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>itm<span class="token punctuation">.</span>age<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>类似省市级，或者需要渲染对象名称，渲染对象属性是一个数组时这种情况。</p> <h2 id="react中如何更好的修改数组中对象的数据？"><a href="#react中如何更好的修改数组中对象的数据？" aria-hidden="true" class="header-anchor">#</a> React中如何更好的修改数组中对象的数据？</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">'学习javascript'</span><span class="token punctuation">,</span>
    completed<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    id<span class="token punctuation">:</span> <span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">'学习react'</span><span class="token punctuation">,</span>
    completed<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    id<span class="token punctuation">:</span> <span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">'学习设计模式'</span><span class="token punctuation">,</span>
    completed<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    id<span class="token punctuation">:</span> <span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
  list
<span class="token punctuation">}</span>
</code></pre></div><p>因为React state都是不能直接更改，如果先重新深克隆再更改，这种操作太麻烦。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 增加</span>
<span class="token keyword">let</span> taskText <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>taskText
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  taskList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>this<span class="token punctuation">.</span>state<span class="token punctuation">.</span>taskList<span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> taskText<span class="token punctuation">,</span> completed<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  taskText<span class="token punctuation">:</span> <span class="token string">''</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 删除 filter</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  taskList<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>taskList<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> id <span class="token operator">!==</span> item<span class="token punctuation">.</span>id
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 修改</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  taskList<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>taskList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      item<span class="token punctuation">.</span>completed <span class="token operator">=</span> <span class="token operator">!</span>item<span class="token punctuation">.</span>completed<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> item<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>因为filter和map都会返回一个新的数组。</p> <h2 id="计算一个数组中某些值的总和？reduce"><a href="#计算一个数组中某些值的总和？reduce" aria-hidden="true" class="header-anchor">#</a> 计算一个数组中某些值的总和？reduce</h2> <div class="language-js extra-class"><pre class="language-js"><code>activeTodoCount <span class="token operator">=</span> taskList<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> cur<span class="token punctuation">.</span>completed <span class="token operator">?</span> acc <span class="token punctuation">:</span> acc <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="生命周期"><a href="#生命周期" aria-hidden="true" class="header-anchor">#</a> 生命周期</h2> <img src="/assets/img/lifecycle.80c208c6.png" style="zoom:150%;"> <p><strong>加粗字体是常用的生命周期函数。</strong></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/intensive-reading-react-redux/React新的前端思维方式.html" class="prev">React新的前端思维方式</a></span> <span class="next"><a href="/intensive-reading-react-redux/React组件的性能优化.html">React组件的性能优化</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5e2fb6a2.js" defer></script><script src="/assets/js/2.e64ac863.js" defer></script><script src="/assets/js/3.41b3c96f.js" defer></script>
  </body>
</html>
